<!DOCTYPE html><html lang="es"><head><title>Alfonso Miranda - Mobile Software Engineer</title><meta name="twitter:title" content="Alfonso Miranda - Mobile Software Engineer"/><meta name="og:title" content="Alfonso Miranda - Mobile Software Engineer"/><meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css"/><link rel="stylesheet" href="/Pure/styles.css"/><link rel="stylesheet" href="/all.css"/></head><body><div id="layout" class="pure-g"><div><div class="pure-menu pure-menu-horizontal pure-u-1-1 top-header"><ul class="pure-menu-list"><li class="pure-menu-item"><a class="pure-menu-link" href="/about">Sobre mi</a></li></ul></div></div><div class="sidebar pure-u-1 pure-u-md-1-4"><div class="header"><div id="layout" class="pure-g"><div class="pure-u-md-1-1 pure-u-3-4"><h1><a class="brand-title" href="/">Alfonso Miranda</a></h1><h3 class="brand-tagline">Mobile Software Engineer</h3></div></div><div id="layout" class="pure-g"><div class="pure-u-md-1-1"><a href="https://www.linkedin.com/in/alfonsomirandacastro/"><i class="fab fa-linkedin l-box social-icon"></i><a class="social-media" href="https://www.linkedin.com/in/alfonsomirandacastro/">LinkedIn</a></a></div><div class="pure-u-md-1-1"><a href="https://github.com/alfonsomiranda"><i class="fab fa-github-square l-box social-icon"></i><a class="social-media" href="https://github.com/alfonsomiranda">GitHub</a></a></div><div class="pure-u-md-1-1"><a href="https://twitter.com/alfonsobeta"><i class="fab fa-twitter-square l-box social-icon"></i><a class="social-media" href="https://twitter.com/alfonsobeta">Twitter</a></a></div><div class="pure-u-md-1-1"><a href="https://twitch.alfonsomiranda.com"><i class="fab fa-twitch l-box social-icon"></i><a class="social-media" href="https://twitch.alfonsomiranda.com">Twitch</a></a></div></div></div></div><div class="content pure-u-1 pure-u-md-3-5 pure-u-xl-6-10"><h2 class="post-title"><a href="/posts/initialization-to-ar">ARKit y RealitityKit: Inicialización a AR en iOS</a></h2><p class="post-meta">19 de mayo de 2021</p><div class="post-tags"><a class="post-category post-category-swift" href="/tags/swift">swift</a><a class="post-category post-category-ar" href="/tags/ar">ar</a><a class="post-category post-category-arkit" href="/tags/arkit">arkit</a><a class="post-category post-category-realitykit" href="/tags/realitykit">realitykit</a><a class="post-category post-category-reality composer" href="/tags/reality-composer">reality composer</a></div><div class="post-description"><div><p>La realidad aumentada existe desde hace muchos años. En iOS tomó especial fuerza cuando en 2017 Apple presentó su framework ARKit. Vamos a ver en qué estado está actualmente, qué podemos hacer y veremos RealitityKit, herramienta de modelado 3D que nos ayuda a potenciar nuestros desarrollos de AR.</p><h1>Creando un proyecto AR</h1><p>Para empezar vamos a crear un nuevo proyecto ARKit seleccionando la opción correspondiente.</p><img src="/images/arkit/createARProject.png" alt="Create AR project" width="800"/><p>Podemos elegir entre varias tecnologías para el contenido, es decir, para nuestra parte virtual. Hasta no hace mucho solo teníamos SceneKit (para modelos 3D), SpriteKit (para modelos 2D) y metal. Recientemente se añadió RealityKit, el cual está especializado para funcionar con realidad aumentada, así que será el que elegiremos.</p><img src="/images/arkit/createProjectSelectRealityKit.png" alt="Select RealityKit" width="800"/><p>Después podemos elegir si trabajar con Storyboard o SwiftUI. Vamos a seleccionar SwiftUI, que es el presente/futuro y nos tenemos que acostumbrar a trabajar con él.</p><img src="/images/arkit/selectSwiftUI.png" alt="Select SwiftUI" width="800"/><p>Y listo, creamos el proyecto y ya tenemos una base con un desarrollo que nos puede servir para ver como funciona de forma básica un proyecto de realidad aumentada.</p><p>En ContentView vemos una de las partes importantes. En primer lugar importamos, en nuestro caso, tanto SwiftUI y RealityKit.</p><pre><code><span class="keyword">import</span> SwiftUI
<span class="keyword">import</span> RealityKit
</code></pre><p>Después nuestra vista será un ARViewContainer, que como su nombre indica será el contenedor de nuestra realidad aumentada, y lo añadimos en nuestra View.</p><pre><code><span class="keyword">struct</span> ContentView : <span class="type">View</span> {
    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> {
        <span class="keyword">return</span> <span class="type">ARViewContainer</span>().<span class="call">edgesIgnoringSafeArea</span>(.<span class="dotAccess">all</span>)
    }
}
</code></pre><p>Y definimos nuestro ARViewContainer de la siguiente forma, en este caso, en el ejemplo básico, cargando un objeto y añadiéndolo en nuestra escena.</p><pre><code><span class="keyword">struct</span> ARViewContainer: <span class="type">UIViewRepresentable</span> {
    
    <span class="keyword">func</span> makeUIView(context: <span class="type">Context</span>) -&gt; <span class="type">ARView</span> {
        
        <span class="keyword">let</span> arView = <span class="type">ARView</span>(frame: .<span class="dotAccess">zero</span>)
        
        <span class="comment">// Load the "Box" scene from the "Experience" Reality File</span>
        <span class="keyword">let</span> boxAnchor = <span class="keyword">try</span>! <span class="type">Experience</span>.<span class="call">loadBox</span>()
        
        <span class="comment">// Add the box anchor to the scene</span>
        arView.<span class="property">scene</span>.<span class="property">anchors</span>.<span class="call">append</span>(boxAnchor)
        
        <span class="keyword">return</span> arView
        
    }
    
    <span class="keyword">func</span> updateUIView(<span class="keyword">_</span> uiView: <span class="type">ARView</span>, context: <span class="type">Context</span>) {}
    
}
</code></pre><p>Pero ... ¿de dónde se está cargando ese objeto? ¿qué es ese objeto llamado 'Experience'?</p><p>Esta es la segunda cosa importante que tenemos que ver, es el fichero Experience.rcproject, que si lo abrimos vemos lo siguiente.</p><img src="/images/arkit/experienceProject.png" alt="experience.project" width="800"/><p>Es nuestro editor del mundo virtual que vamos a pintar en nuestra realidad. En el ejemplo básico, tan solo tenemos un cubo en el centro de nuestro mundo, que si ejecutamos el proyecto (recordemos que solo funciona en dispositivo) veremos el resultado.</p><img src="/images/arkit/cubeAR.jpeg" alt="Cube in AR" width="800"/><p>En la esquina superior derecha veremos un botón "Open in Reality Composer", y ahí tenemos el tercer elemento importante para empezar a construir apps de AR.</p><p>Abrimos el archivo con Reality Composer y podremos empezar a editar, añadir y crear mundos virtuales. Vamos a ver varios ejemplos de lo que podemos hacer.</p><img src="/images/arkit/sceneHorizontal.png" alt="Horizontal scene" width="800"/><p>Como vemos, tenemos nuestro cubo virtual que ya vimos como único elemento en nuestra única escena. Si vemos el nombre de la escena es "Box", y si recordamos, en el código para cargar el archivo era de la siguiente forma.</p><pre><code><span class="keyword">let</span> boxAnchor = <span class="keyword">try</span>! <span class="type">Experience</span>.<span class="call">loadBox</span>()
</code></pre><p>Lo iremos viendo, pero el patrón sería similar con las diferentes escenas que creemos, y podremos acceder a ellas con un método 'loadNombreEscena()'</p><p>Si miramos en la parte derecha, en el menú, podemos ver varias cosas interesantes. En primer lugar tenemos diferentes tipos de escena.</p><p>La que tenemos creada es horizontal, que significa que el objeto lo pinta en un plano horizontal que detecte. Como hemos visto, nuestro cubo se ha añadido en una mesa, detectándola como un plano horizontal.</p><p>La segunda opción es 'Vertical", y funciona de forma similar pero detectando un plano vertical, y podemos hacer la prueba poniendo un objeto y al detectar una pared lo añadirá a la realidad.</p><p>La tercera opción es el reconocimiento de una imagen. En esta opción nos podemos parar un poquito y vamos a crear una escena.</p><img src="/images/arkit/imageScene.png" alt="Image recognization scene" width="800"/><img src="/images/arkit/imageRecognizationScene.png" alt="Image recognization scene" width="800"/><p>Nos añade dos elementos a la escena, una especie de plano horizontal y un objeto 3D. En la derecha vemos que podemos seleccionar una imagen para ese plano, que será el que nos detecte. Esta imagen tiene que tener unas características concreta, una diferencia de colores y formas concretas que sean suficientes para reconocer la imagen. Si añadimos una imagen no válida nos avisará.</p><img src="/images/arkit/imageRecognizationError.png" alt="Image recognization scene error" width="800"/><p>Pero si encontramos una óptimas lo añadirá sin más problema.</p><img src="/images/arkit/imageRecognizationSuccess.png" alt="Image recognization scene success" width="800"/><p>Y si ejecutamos este proyecto podemos ver en el siguiente video como reconoce la imagen y añade el modelo que hemos definido.</p><video width="800" height="800" controls>
  <source src="/videos/imageRecognization.mp4" type="video/mp4">
</video><p>Nos quedarían dos tipos de escenas más, reconocimiento de caras y reconocimiento de objetos, pero da para un artículo cada uno que veremos próximamente.</p><p>Hasta ahora no hemos añadido más objetos que el que nos crea por defecto. Si le damos al "+" (añadir) que tenemos en la parte superior nos saldrá un selector donde podremos elegir entre un buen banco de modelos que nos proporciona Apple, desde figuras básicas como elementos comunes. Además, podemos importar nuestros propios modelos. Estos modelos deberían estar en formato usdz, pero si lo tenemos en otro tipo que sea compatible podríamos convertirlo con la herramienta <a href="https://developer.apple.com/news/?id=01132020a&1578956733">usdzconverter</a> o en esta <a href="página online">https://spase.io/playground</a> de forma mucho más cómoda.</p><img src="/images/arkit/addModels.png" alt="Add models" width="800"/><p>Existen más elementos relacionados con la física, materiales, gravedad y comportamientos muy interesantes, así como oclusión, que veremos en otro artículo más avanado.</p><p>Si queréis, en este directo que hice en <a href="twitch">http://twitch.alfonsomiranda.com</a> y que está en <a href="https://www.youtube.com/watch?v=YzssNbP5q8Q&ab_channel=Serquo">Youtube</a> podéis ver más tranquilamente lo escrito aquí y un poquito más.</p></div></div></div><div class="footer pure-u-1"><div class="pure-u-1">© 2021 Alfonso Miranda</div><div class="pure-u-1">Generated using <a href="https://github.com/johnsundell/publish">Publish</a>. Written in Swift</div><div class="pure-u-1"><a href="/feed.rss">RSS feed</a></div></div></div></body></html>